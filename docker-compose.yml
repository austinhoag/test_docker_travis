version: "3.4"

services:
  flask-demo:
    env_file: .env
    build:
      context: ./flask-demo
      dockerfile: flask-demo.Dockerfile
    command: python run.py
    volumes:
      - ./flask-demo:/app
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - '5005:5005'
  testflask:
    env_file: .testdockerenv
    build:
      context: ./flask-demo
      dockerfile: flask-demo.Dockerfile
    command: bash -c "pytest -p no:cacheprovider --cov=flask-demo/tests -vs flask-demo/tests && mv .coverage /shared"
    volumes:
      - .:/app # so changes made to the app are propagated to the container without having to rebuild
      - $PWD/shared:/shared